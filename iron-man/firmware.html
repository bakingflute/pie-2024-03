<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Firmware - Ironman Project</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="assets/styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
      <a class="navbar-brand" href="index.html">Ironman Project</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
          <li class="nav-item"><a class="nav-link" href="electrical.html">Electrical</a></li>
          <li class="nav-item"><a class="nav-link" href="mechanical.html">Mechanical</a></li>
          <li class="nav-item"><a class="nav-link" href="software.html">Software</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Firmware Section -->
  <!-- Page Container -->
  <div class="container mt-5">
    
    <!-- Firmware Section -->
    <div class="firmware-section">
      <h2 class="section-header">Firmware</h2>
      <p class="firmware-description">The firmware controls the interaction between the electrical components and the rest of the system. It is responsible for reading data from sensors, processing it, and controlling actuators like our servos. The firmware is developed in both Arduino and Python, and it manages the communication between each component and our microcontrollers (Arduino Nano, Raspbbery Pi 5).</p>
      <p class="firmware-description">Key functionalities of the firmware include:</p>
      <ul>
        <li>Sensor data acquisition (e.g., touch sensor, microphone)</li>
        <li>Control of output devices (e.g., servos, OLED display, speaker, camera)</li>
        <li>Real-time decision-making and response handling</li>
        <li>Communication with the system's Python-based software</li>
      </ul>

      <p class="firmware-description">For the majority of our components, we were able to centralize all its firmware in the JarvisArduino.ino file which we uploaded to our Arduino Nano. The Nano connected the servos, display, and touch sensor together. On the other hand, for our camera, microphone, and speaker, which were all connected to our Raspberry Pi 5 instead, we were able to abstract out much of the firmware;
        the microphone was automatically recognized by the Raspberry Pi 5 and accepted without any additional configuration after plugging it into one of the Pi's 4 USB ports. Additionally, for the sake of audio quality, we decided to use a bluetooth speaker over a wired one. Therefore, after configuring the bluetooth once with the Pi upon setup, we could rely on the bluetooth speaker syncing whenever they were both powered on.
        Lastly, for our PiCamera v2, we ended up using a roundabout way to program its firmware. There exists two libraries to assist in using the PiCamera v2: the libcamera and picamera2 libraries. However, after all sorts of debugging with these libraries, we could not use the standard Python syntax: 
      </p>
      <br/>
      <code>
        from picamera2 import Picamera2, Preview <br/>
        import time <br/>
        picam2 = Picamera2() <br/>
        camera_config = picam2.create_still_configuration(main={"size": (1920, 1080)}, lores={"size": (640, 480)}, display="lores") <br/>
        picam2.configure(camera_config) <br/>
        picam2.start_preview(Preview.QTGL) <br/>
        picam2.start() <br/>
        time.sleep(2) <br/>
        picam2.capture_file("test.jpg") <br/>
      </code>
      
      <p class="firmware-description">
        to function properly. Instead, we used the built-in Python <a href="https://www.geeksforgeeks.org/python-subprocess-module/">subprocess module</a> to run bash commands from within our Python script--which opened the door for the semi-working libcamera Linux software. 
        Using libcamera, we could use the libcamera-still command that can take pictures from a preview using the command line. However, we were dealing with an error on the Raspberry Pi 5 that required us to pass in the --qt flag alongside this libcamera command. Fortunately,
        python's subprocess module has an easy way to add flags to bash commands:
      </p>
      <br/>
      <code>
        subprocess.run( 
        [
            "libcamera-still",
            "-o",
            f"images/{now:%Y-%m-%d %H:%M}.jpg",
            "--qt",
        ]
        )
      </code>
      <p class="firmware-description">To have a better insight on other metadata we can incorporate into our images, we used the built-in Python datetime module that helps us get the current time in Python. We stored each image with the name of the time the picture was taken. Those % indicators are
        flags that track the year, month, date, hour, and minute the photo was taken. This PiCamera firmware was baked into our Python software file, triggered by the voice assistant.
      </p>
      <br/>
      <p  class="firmware-description">
        Finally, to handle communication between our Arduino JarvisArduino.ino file and our Python jarvis_v3.py file, we used a two-way serial connection. Configuring each file to begin its serial on 9600 baud, we had the Python software file that leveraged the voice assistant print messages on the serial like "&lt;Activate Jarvis&gt;", 
        "&lt;Open Helmet&gt;", "&lt;Close Helmet&gt;" etc. All the while, the Arduino file would be listening in on the same baud rate for any serial messages that come in. If the Arduino recognized these strings, it would update variables that would then lead to actuation of servos, displaying animations on the OLED, etc. 
      </p>
      
      <p>For a deeper look at the firmware code, visit the <a href="https://github.com/olincollege/iron-man/blob/main/JarvisArduino.ino">JarvisArduino.ino file in our GitHub repository</a> to view the source code.</p>
    </div>

  </div>



  <!-- Footer -->
  <footer class="text-center py-4 bg-dark text-light">
    <p>&copy; 2024 Ironman Project. All rights reserved.</p>
  </footer>
</body>
</html>
